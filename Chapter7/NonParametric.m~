% NonParametric.m
% Generates illustration and figures for non-parametric density estimation
% in Chapter 7.2.5
% Author: Lewis Li
% Original Date: Nov 22nd 2016


% Generate some fake data for illustration. On purpose i will use a
% Gaussian Mixture model
num_mixtures = 10;
num_dim = 2;
rng(1); % For reproducibility
mu = zeros(num_mixtures,num_dim);
sigma = zeros(num_dim,num_dim,num_mixtures);

% Populate each Gaussian with random mean and covariance
for i = 1:num_mixtures
    mu(i,:) = randn(num_dim,1)*5;
    A = rand(num_dim);
    A = 0.5*(A+A');
    sigma(:,:,i) = A + num_dim*eye(num_dim);
end

% Uniform mixture weights
p = ones(1,num_mixtures)/num_mixtures;

% Create GM object and sample from it
obj = gmdistribution(mu,sigma,p);
Y = random(obj,1000);
h = Y(:,1);
d = Y(:,2);
x_range = [min(d) max(d)];
y_range = [min(h) max(h)];


h1 = scatter(d,h,50,'filled');
FormatPlot(h1,'d','h');
ax = gca;
%%
% generate a Gaussian mixture with distant modes
addpath('../common/kde2d');
MIN_XY = [min(d) min(h)];
MAX_XY = [max(d) max(h)];
[bandwidth,density,xcoord,ycoord]=kde2d(Y,512,MIN_XY,MAX_XY);

%%
figure
nx = 512;
xtick = linspace(x_range,
h2 = imagesc(flipud(density));
grid on;
FormatPlot(h2,'d','h');
set(gca, 'XTick', [0:0.1:1]*nx, 'XTickLabel', [0:0.1:1]*10) % 10 ticks 
set(gca, 'YTick', [0:0.05:1]*nx, 'YTickLabel', [0:0.05:1]) % 20 ticks

